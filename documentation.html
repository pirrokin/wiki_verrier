<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - Technician Wiki</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/lightbox.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

</head>

<body>
    <nav class="navbar">
        <div class="nav-left">
            <button class="menu-toggle-btn" onclick="toggleMainMenu()">
                <span class="material-icons">apps</span>
            </button>

            <!-- Main Navigation Menu (Hidden by default) -->
            <div class="nav-main-menu" id="mainNavMenu">
                <a href="admin.html" class="nav-menu-item">
                    <span class="material-icons">home</span> Accueil
                </a>

                <div class="nav-menu-header">Technicien</div>
                <a href="pdms.html" class="nav-menu-item">
                    <span class="material-icons">storage</span> PDMS
                </a>

                <div class="nav-menu-header">Ressources</div>
                <a href="documentation.html" class="nav-menu-item">
                    <span class="material-icons">menu_book</span> Wiki
                </a>
            </div>
        </div>

        <div class="nav-center">
            <a href="admin.html" class="nav-brand">
                <img src="images/logo.png" alt="Logo" class="nav-logo">
                <span>Technician Wiki</span>
            </a>
        </div>

        <div class="nav-right">
            <div class="user-menu-container">
                <button class="user-menu-btn" onclick="toggleUserMenu()">
                    <img src="images/default-avatar.svg" id="navUserAvatar" alt="Avatar">
                    <span id="navUserName">...</span>
                    <span class="material-icons">arrow_drop_down</span>
                </button>
                <div class="user-dropdown" id="userDropdown">
                    <a href="profile.html" class="dropdown-item">
                        <span class="material-icons">person</span> Mon Profil
                    </a>
                    <a href="admin_interface.html" class="dropdown-item" id="navAdminLink" style="display: none;">
                        <span class="material-icons">settings</span> Administration
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" onclick="logout()" class="dropdown-item logout-item">
                        <span class="material-icons">logout</span> Déconnexion
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-container" style="max-width: 100%; padding: 20px;">
        <div style="margin-bottom: 20px;">
            <h1 class="welcome-title">Base de Connaissances</h1>
            <p class="welcome-subtitle">Retrouvez tous les processus et documentations techniques.</p>
        </div>

        <input type="text" class="search-bar" id="searchInput" placeholder="Rechercher un processus..."
            oninput="handleSearch()">

        <div class="doc-layout">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h3 style="margin: 0;">Catégories</h3>
                    <button class="btn-icon" onclick="openCategoryModal()" title="Ajouter une catégorie">
                        <span class="material-icons">add</span>
                    </button>
                </div>
                <div class="sidebar-content" id="categoryList">
                    <!-- Categories will be loaded here -->
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div id="processViewer" class="viewer-container">
                    <div class="empty-state">
                        <span class="material-icons"
                            style="font-size: 64px; margin-bottom: 20px; color: #333;">library_books</span>
                        <h2>Sélectionnez un processus</h2>
                        <p>Naviguez dans les catégories à gauche ou utilisez la recherche.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('categoryModal')"><span
                    class="material-icons">close</span></button>
            <h2>Nouvelle Catégorie</h2>
            <form id="addCategoryForm">
                <div class="input-group">
                    <label>Nom de la catégorie</label>
                    <input type="text" id="newCategoryName" required placeholder="Ex: Office">
                </div>
                <button type="submit" class="btn-login">Créer</button>
            </form>
        </div>
    </div>

    <!-- Add Process Modal -->
    <div id="processModal" class="modal">
        <div class="modal-content" style="width: 800px; max-width: 90vw;">
            <button class="close-modal" onclick="closeModal('processModal')"><span
                    class="material-icons">close</span></button>
            <h2>Nouveau Processus</h2>
            <form id="addProcessForm">
                <input type="hidden" id="targetCategoryId">

                <div class="input-group">
                    <label>Titre du processus</label>
                    <input type="text" id="newProcessTitle" required placeholder="Ex: Comment imprimer">
                </div>

                <div class="input-group">
                    <label style="margin-bottom: 10px; display: block;">Type de contenu</label>
                    <div class="type-selector">
                        <label class="type-option">
                            <input type="radio" name="processType" id="processTypePdf" value="pdf" checked
                                onchange="toggleProcessType()">
                            <span class="type-card">
                                <span class="material-icons">picture_as_pdf</span>
                                <span>PDF</span>
                            </span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="processType" id="processTypeText" value="text"
                                onchange="toggleProcessType()">
                            <span class="type-card">
                                <span class="material-icons">article</span>
                                <span>Article</span>
                            </span>
                        </label>
                        <label class="type-option">
                            <input type="radio" name="processType" id="processTypeWord" value="word"
                                onchange="toggleProcessType()">
                            <span class="type-card">
                                <span class="material-icons">description</span>
                                <span>Word</span>
                            </span>
                        </label>
                    </div>
                </div>

                <div id="pdfUploadSection" class="input-group">
                    <label>Fichier PDF</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="newProcessFile" accept=".pdf" onchange="updateFileLabel(this)">
                        <div class="file-input-label">
                            <span class="material-icons">cloud_upload</span>
                            <span>Choisir un fichier PDF</span>
                        </div>
                    </div>
                </div>

                <div id="wordImportSection" class="input-group" style="display: none;">
                    <label>Fichier Word (.docx)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="wordFileInput" accept=".docx"
                            onchange="handleWordImport(this); updateFileLabel(this)">
                        <div class="file-input-label">
                            <span class="material-icons">description</span>
                            <span>Choisir un fichier Word</span>
                        </div>
                    </div>
                    <p style="font-size: 12px; color: #888; margin-top: 5px;">Le contenu sera converti et ajouté à
                        l'éditeur ci-dessous pour validation.</p>
                </div>

                <div id="editorSection" class="input-group" style="display: none;">
                    <label>Contenu de l'article</label>
                    <div id="editor-container" style="height: 300px; background: white; color: black;"></div>
                </div>

                <button type="submit" class="btn-login" style="margin-top: 20px;">Créer</button>
            </form>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h2 style="margin-bottom: 10px;">Confirmation</h2>
            <p id="confirmMessage" style="margin-bottom: 25px; color: var(--text-secondary);">Êtes-vous sûr ?</p>
            <div style="display: flex; justify-content: center; gap: 15px;">
                <button type="button" class="btn-secondary" onclick="closeModal('confirmModal')">Annuler</button>
                <button type="button" class="btn-primary" id="confirmActionBtn"
                    style="background-color: #ff5252;">Supprimer</button>
            </div>
        </div>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- Quill.js Library -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- Mammoth.js Library for Word Import -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

    <!-- Lightbox for Image Zoom -->
    <div id="lightbox" class="lightbox">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-img">
    </div>

    <script src="js/navbar.js"></script>
    <script src="js/documentation.js"></script>
</body>

</html>